"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{3022:function(e,t,r){r.d(t,{Z:function(){return Layout}});var s=r(5893),a=r(6266),l=r(1163),n=r(1664),o=r.n(n),i=r(4933),c=r(3761),d=r(5077),h=r(3777),m=r(4622),x=r(1408),u=r(9525),f=r(1629),b=r(5041),p=r(1352),g=r(7232),j=r(8142),v=r(8051),y=r(6501),N=r(7294),w=r(8815);function Layout(e){let{children:t}=e,{currentUser:r,userProfile:n,logout:k}=(0,a.a)(),P=(0,l.useRouter)(),[C,Z]=(0,N.useState)(null),[L,U]=(0,N.useState)(!1),[S,M]=(0,N.useState)(!1);async function fetchProfilePhoto(){try{let{data:e}=await w.T.getProfilePhoto(r.uid);e&&e.profile_photo_url&&Z(e.profile_photo_url)}catch(e){console.error("Error fetching profile photo:",e)}}async function handleLogout(){try{await k(),y.ZP.success("Logged out successfully"),P.push("/")}catch(e){y.ZP.error("Failed to logout")}}async function handleProfilePhotoUpload(e){try{let{data:t,error:s}=await w.T.saveProfilePhoto(r.uid,e);if(s){y.ZP.error(s.message);return}Z(t.profile_photo_url),U(!1),y.ZP.success("Profile photo updated successfully!")}catch(e){y.ZP.error("Failed to upload profile photo")}}if((0,N.useEffect)(()=>{r&&fetchProfilePhoto()},[r]),!r||!n)return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})});let _="teacher"===n.role,E="student"===n.role,R=[...E?[{name:"Dashboard",href:"/student/dashboard",icon:i.Z},{name:"My Classes",href:"/student/classes",icon:c.Z},{name:"Timetable",href:"/student/timetable",icon:d.Z},{name:"Quick Attendance",href:"/student/instant-attendance",icon:h.Z},{name:"My Attendance",href:"/student/history",icon:m.Z},{name:"Enroll Face",href:"/student/enroll",icon:x.Z},{name:"Profile",href:"/student/profile",icon:i.Z}]:[],..._?[{name:"Dashboard",href:"/teacher/dashboard",icon:u.Z},{name:"My Classes",href:"/teacher/classes",icon:c.Z},{name:"Timetable",href:"/teacher/timetable",icon:d.Z},{name:"Instant Attendance",href:"/teacher/instant-attendance",icon:h.Z},{name:"Students",href:"/teacher/students",icon:i.Z},{name:"Reports",href:"/teacher/reports",icon:m.Z},{name:"Analytics",href:"/teacher/analytics",icon:f.Z},{name:"Profile",href:"/teacher/profile",icon:x.Z}]:[]];return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,s.jsx)("nav",{className:"bg-white/95 backdrop-blur-md shadow-lg border-b border-gray-200/50 sticky top-0 z-40",children:(0,s.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center h-24",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsxs)(o(),{href:"teacher"===n.role?"/teacher/dashboard":"/student/dashboard",className:"flex items-center hover:opacity-80 transition-opacity cursor-pointer",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(b.Z,{className:"h-10 w-10 text-blue-600 mr-4"}),(0,s.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"})]}),(0,s.jsxs)("div",{className:"hidden sm:block",children:[(0,s.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"Smart Attendance"}),(0,s.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"AI-Powered Recognition"})]}),(0,s.jsx)("div",{className:"sm:hidden",children:(0,s.jsx)("span",{className:"text-xl font-bold text-gray-900",children:"Smart Attendance"})})]})}),(0,s.jsx)("div",{className:"flex-1 flex justify-center items-center mx-4",children:(0,s.jsx)("div",{className:"hidden md:flex items-center justify-center space-x-1 w-full overflow-x-auto",children:R.map(e=>{let t=e.icon,r=P.pathname===e.href;return(0,s.jsxs)(o(),{href:e.href,className:"flex items-center px-2 md:px-3 py-2 rounded-xl text-xs md:text-sm font-medium transition-all duration-200 whitespace-nowrap flex-shrink-0 ".concat(r?"text-blue-600 bg-blue-50 shadow-sm border border-blue-200":"text-gray-600 hover:text-gray-900 hover:bg-gray-50 hover:shadow-sm"),children:[(0,s.jsx)(t,{className:"h-4 w-4 mr-1 md:mr-2"}),(0,s.jsx)("span",{className:"hidden md:inline",children:e.name})]},e.name)})})}),(0,s.jsxs)("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>M(!S),className:"md:hidden p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors",children:S?(0,s.jsx)(p.Z,{className:"h-6 w-6"}):(0,s.jsx)(g.Z,{className:"h-6 w-6"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("div",{className:"relative group",children:[C?(0,s.jsx)("img",{src:C,alt:"Profile",className:"w-12 h-12 rounded-full object-cover border-2 border-blue-200 shadow-sm cursor-pointer hover:border-blue-400 transition-all",onClick:()=>"teacher"===n.role&&U(!0)}):(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center border-2 border-blue-200 cursor-pointer hover:border-blue-400 transition-all",onClick:()=>"teacher"===n.role&&U(!0),children:(0,s.jsx)(i.Z,{className:"h-6 w-6 text-blue-600"})}),"teacher"===n.role&&(0,s.jsx)("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors",onClick:()=>U(!0),children:(0,s.jsx)(j.Z,{className:"h-3 w-3 text-white"})})]}),(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsxs)(o(),{href:"teacher"===n.role?"/teacher/profile":"/student/profile",className:"text-sm hover:bg-gray-50 rounded-lg p-2 transition-colors cursor-pointer block",children:[(0,s.jsx)("div",{className:"font-semibold text-gray-900 hover:text-blue-600 transition-colors",children:n.name}),(0,s.jsxs)("div",{className:"text-gray-500 capitalize flex items-center",children:[(0,s.jsx)("span",{className:"inline-block w-2 h-2 rounded-full mr-2 ".concat("teacher"===n.role?"bg-purple-400":"bg-blue-400")}),n.role]})]})})]}),(0,s.jsxs)("button",{onClick:handleLogout,className:"hidden sm:flex items-center px-4 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all duration-200 hover:shadow-sm",children:[(0,s.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"Logout"}),(0,s.jsx)("span",{className:"md:hidden",children:"Exit"})]})]})]})]})})}),S&&(0,s.jsx)("div",{className:"md:hidden bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg",children:(0,s.jsxs)("div",{className:"px-4 py-4 space-y-2",children:[(0,s.jsx)("div",{className:"space-y-1",children:R.map(e=>{let t=e.icon,r=P.pathname===e.href;return(0,s.jsxs)(o(),{href:e.href,onClick:()=>M(!1),className:"flex items-center px-4 py-3 rounded-xl text-base font-medium transition-all duration-200 ".concat(r?"text-blue-600 bg-blue-50 shadow-sm border border-blue-200":"text-gray-700 hover:text-gray-900 hover:bg-gray-50 hover:shadow-sm"),children:[(0,s.jsx)(t,{className:"h-5 w-5 mr-4"}),e.name]},e.name)})}),(0,s.jsxs)("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[(0,s.jsx)(o(),{href:"teacher"===n.role?"/teacher/profile":"/student/profile",onClick:()=>M(!1),className:"flex items-center px-4 py-3 text-base text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all duration-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[C?(0,s.jsx)("img",{src:C,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-blue-200 mr-3"}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center border-2 border-blue-200 mr-3",children:(0,s.jsx)(i.Z,{className:"h-4 w-4 text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold text-gray-900",children:(null==n?void 0:n.name)||"User"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 capitalize flex items-center",children:[(0,s.jsx)("span",{className:"inline-block w-2 h-2 rounded-full mr-2 ".concat("teacher"===n.role?"bg-purple-400":"bg-blue-400")}),n.role]})]})]})}),(0,s.jsxs)("button",{onClick:()=>{M(!1),handleLogout()},className:"flex items-center w-full px-4 py-3 text-base text-red-600 hover:text-red-700 hover:bg-red-50 rounded-xl transition-all duration-200 mt-2",children:[(0,s.jsx)(v.Z,{className:"h-5 w-5 mr-4"}),"Logout"]})]})]})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:t}),L&&"teacher"===n.role&&(0,s.jsx)(ProfilePhotoUploadModal,{onClose:()=>U(!1),onUpload:handleProfilePhotoUpload,currentPhoto:C})]})}function ProfilePhotoUploadModal(e){let{onClose:t,onUpload:r,currentPhoto:a}=e,[l,n]=(0,N.useState)(null),[o,c]=(0,N.useState)(a),[d,h]=(0,N.useState)(!1),[m,x]=(0,N.useState)(!1);function handleFileSelect(e){let t=e.target.files[0];if(t){n(t);let e=URL.createObjectURL(t);c(e)}}async function handleUpload(){if(l){h(!0);try{await r(l)}finally{h(!1)}}}function handleCameraCapture(e){fetch(e).then(e=>e.blob()).then(t=>{let r=new File([t],"camera-photo.jpg",{type:"image/jpeg"});n(r),c(e),x(!1)})}return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Update Profile Photo"}),(0,s.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,s.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"text-center mb-6",children:o?(0,s.jsx)("img",{src:o,alt:"Preview",className:"w-32 h-32 rounded-full object-cover border-4 border-gray-200 mx-auto shadow-lg"}):(0,s.jsx)("div",{className:"w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center mx-auto",children:(0,s.jsx)(i.Z,{className:"h-16 w-16 text-gray-400"})})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)("label",{className:"flex-1 bg-blue-50 hover:bg-blue-100 text-blue-700 font-medium py-3 px-4 rounded-xl cursor-pointer transition-colors text-center",children:[(0,s.jsx)(j.Z,{className:"h-5 w-5 inline mr-2"}),"Upload Photo",(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:handleFileSelect,className:"hidden"})]}),(0,s.jsxs)("button",{onClick:()=>x(!0),className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 font-medium py-3 px-4 rounded-xl transition-colors",children:[(0,s.jsx)(b.Z,{className:"h-5 w-5 inline mr-2"}),"Take Photo"]})]}),l&&(0,s.jsx)("button",{onClick:handleUpload,disabled:d,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-xl transition-all disabled:opacity-50",children:d?"Uploading...":"Save Photo"})]}),m&&(0,s.jsx)(CameraCapture,{onCapture:handleCameraCapture,onClose:()=>x(!1)})]})})}function CameraCapture(e){let{onCapture:t,onClose:r}=e,[a,l]=(0,N.useState)(null),n=(0,N.useRef)(null),o=(0,N.useRef)(null);async function startCamera(){try{let e=await navigator.mediaDevices.getUserMedia({video:!0});l(e),n.current&&(n.current.srcObject=e)}catch(e){console.error("Error accessing camera:",e),y.ZP.error("Could not access camera")}}function capturePhoto(){if(n.current&&o.current){let e=o.current,r=n.current;e.width=r.videoWidth,e.height=r.videoHeight;let s=e.getContext("2d");s.drawImage(r,0,0);let a=e.toDataURL("image/jpeg");t(a)}}return(0,N.useEffect)(()=>(startCamera(),()=>{a&&a.getTracks().forEach(e=>e.stop())}),[]),(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-60",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold",children:"Take Photo"}),(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("video",{ref:n,autoPlay:!0,playsInline:!0,className:"w-full rounded-lg"}),(0,s.jsx)("canvas",{ref:o,className:"hidden"}),(0,s.jsxs)("button",{onClick:capturePhoto,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors",children:[(0,s.jsx)(b.Z,{className:"h-5 w-5 inline mr-2"}),"Capture Photo"]})]})]})})}}}]);