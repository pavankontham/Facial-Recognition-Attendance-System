(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[314],{1629:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},3761:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]])},4622:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},5041:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},3756:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5077:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6915:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},6609:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]])},8051:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},7232:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]])},1408:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3777:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]])},8142:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},4933:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9525:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},2027:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},1352:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},3559:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/teacher/instant-attendance",function(){return a(1140)}])},1140:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return InstantAttendance}});var s=a(5893),n=a(7294),r=a(3022),i=a(6266),c=a(8815),l=a(6501),d=a(3777),o=a(6609),u=a(6915),h=a(5077),m=a(4297);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,m.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var y=a(2027),f=a(9525),g=a(3756);function InstantAttendance(){let{currentUser:e}=(0,i.a)(),[t,a]=(0,n.useState)([]),[m,p]=(0,n.useState)(null),[v,b]=(0,n.useState)(""),[k,w]=(0,n.useState)(null),[j,N]=(0,n.useState)(0),[Z,P]=(0,n.useState)([]),[C,M]=(0,n.useState)(!0);async function fetchClasses(){try{let{data:t,error:s}=await c.T.getClassesByTeacher(e.uid);s?l.ZP.error(s.message):a(t||[])}catch(e){console.error("Error fetching classes:",e),l.ZP.error("Failed to fetch classes")}finally{M(!1)}}async function generateInstantPassword(){if(!m){l.ZP.error("Please select a class first");return}try{let{data:t,error:a}=await c.T.generateInstantPassword(m.id,1,e.uid);if(a){l.ZP.error(a.message||"Failed to generate password");return}if(t&&t.password){let e=new Date(t.expires_at).getTime();b(t.password),w(e),N(e-new Date().getTime()),l.ZP.success("Instant password generated! Valid for 3 minutes.")}else l.ZP.error("Failed to generate password")}catch(e){console.error("Error generating password:",e),l.ZP.error("Failed to generate password. Please try again.")}}function copyPassword(){v&&(navigator.clipboard.writeText(v),l.ZP.success("Password copied to clipboard!"))}async function invalidatePassword(t){try{await c.T.invalidateInstantPassword(t,e.uid)}catch(e){console.error("Error invalidating password:",e)}}function formatTime(e){return"".concat(Math.floor(e/6e4),":").concat(Math.floor(e%6e4/1e3).toString().padStart(2,"0"))}async function markAttendanceManually(t,a){try{var s;let n=await fetch("".concat("http://localhost:8000","/api/current-slot")),r=await n.json(),i=(null===(s=r.data)||void 0===s?void 0:s.current_slot)||1,{error:d}=await c.T.markAttendance({student_firebase_id:t,class_id:m.id,slot_number:i,status:a,marked_by:"teacher",teacher_firebase_id:e.uid});if(d){let e=d.message;e.includes("already marked")?e="Attendance already marked for this student today.":e.includes("Student not found")?e="Student not found. Please refresh the page and try again.":e.includes("not enrolled")?e="Student is not enrolled in this class.":e.includes("permission")?e="You don't have permission to mark attendance for this class.":e.includes("Database connection")&&(e="Connection error. Please try again in a moment."),l.ZP.error(e)}else{let e=Z.find(e=>e.firebase_id===t),s=(null==e?void 0:e.name)||"Student";l.ZP.success("".concat(s," marked as ").concat(a," for Slot ").concat(i)),fetchAttendanceData()}}catch(t){console.error("Error marking attendance:",t);let e="Failed to mark attendance. Please try again.";"TypeError"===t.name&&t.message.includes("fetch")?e="Network error. Please check your internet connection and try again.":t.message.includes("timeout")?e="Request timed out. Please try again in a moment.":t.message.includes("NetworkError")?e="Network connection failed. Please check your internet connection.":t.message.includes("500")?e="Server error. Please try again later or contact support.":(t.message.includes("401")||t.message.includes("403"))&&(e="Authentication error. Please refresh the page and try again."),l.ZP.error(e)}}async function fetchAttendanceData(){if(m)try{let{data:e,error:t}=await c.T.getClassStudents(m.id);if(t){let e=t.message;e.includes("Class not found")?e="Class not found. Please refresh the page and try again.":e.includes("permission")?e="You don't have permission to view this class data.":e.includes("Database connection")&&(e="Connection error. Please try again in a moment."),l.ZP.error(e)}else e&&P(e)}catch(t){console.error("Error fetching attendance data:",t);let e="Failed to load attendance data. Please try again.";"TypeError"===t.name&&t.message.includes("fetch")?e="Network error. Please check your internet connection and try again.":t.message.includes("timeout")?e="Request timed out. Please try again in a moment.":t.message.includes("NetworkError")?e="Network connection failed. Please check your internet connection.":t.message.includes("500")&&(e="Server error. Please try again later or contact support."),l.ZP.error(e)}}return((0,n.useEffect)(()=>{e&&fetchClasses()},[e]),(0,n.useEffect)(()=>{let e;return k&&(e=setInterval(()=>{let e=new Date().getTime(),t=Math.max(0,k-e);N(t),0===t&&(v&&invalidatePassword(v),b(""),w(null),(0,l.ZP)("Instant password has expired",{icon:"ℹ️"}))},1e3)),()=>{e&&clearInterval(e)}},[k]),(0,n.useEffect)(()=>{m&&fetchAttendanceData()},[m]),C)?(0,s.jsx)(r.Z,{children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"loading-spinner"})})}):(0,s.jsx)(r.Z,{children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-green-600 to-blue-600 rounded-2xl p-8 text-white",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm",children:(0,s.jsx)(d.Z,{className:"h-8 w-8 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Instant Attendance"}),(0,s.jsx)("p",{className:"text-green-100 text-lg",children:"Generate temporary passwords for quick attendance marking"})]})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Select Class"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,s.jsxs)("button",{onClick:()=>p(e),className:"p-4 rounded-lg border-2 transition-all text-left ".concat((null==m?void 0:m.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.subject}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.student_count||0," students"]})]},e.id))})]}),m&&(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Instant Password"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Class: ",(0,s.jsx)("span",{className:"font-medium",children:m.name})]})]}),v?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsxs)("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-8 mb-6",children:[(0,s.jsx)("div",{className:"text-4xl font-bold text-green-600 mb-2 font-mono tracking-wider",children:v}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[(0,s.jsxs)("button",{onClick:copyPassword,className:"bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-lg text-sm transition-colors",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-1 inline"}),"Copy"]}),(0,s.jsxs)("div",{className:"text-green-700 font-medium",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 mr-1 inline"}),formatTime(j)," remaining"]})]}),(0,s.jsx)("div",{className:"w-full bg-green-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-1000",style:{width:"".concat(j/18e4*100,"%")}})})]}),(0,s.jsxs)("div",{className:"flex space-x-4 justify-center",children:[(0,s.jsxs)("button",{onClick:generateInstantPassword,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:[(0,s.jsx)(x,{className:"h-4 w-4 mr-2 inline"}),"Generate New"]}),(0,s.jsxs)("button",{onClick:async()=>{v&&await invalidatePassword(v),b(""),w(null),N(0),l.ZP.success("Session stopped and password invalidated")},className:"bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4 mr-2 inline"}),"Stop Session"]})]})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(o.Z,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Generate Instant Password"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Create a 6-digit password that students can use to mark attendance for the next 3 minutes"}),(0,s.jsxs)("button",{onClick:generateInstantPassword,className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 mr-2 inline"}),"Generate Password"]})]})]}),m&&(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Manual Attendance"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Mark attendance manually for students in this class"}),0===Z.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(f.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"No students enrolled in this class"})]}):(0,s.jsx)("div",{className:"space-y-3",children:Z.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-blue-600 font-semibold text-sm",children:e.name.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.student_id})]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>markAttendanceManually(e.firebase_id,"present"),className:"bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-lg text-sm transition-colors",children:[(0,s.jsx)(g.Z,{className:"h-4 w-4 mr-1 inline"}),"Present"]}),(0,s.jsxs)("button",{onClick:()=>markAttendanceManually(e.firebase_id,"absent"),className:"bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg text-sm transition-colors",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4 mr-1 inline"}),"Absent"]})]})]},e.id))})]})]})})}}},function(e){e.O(0,[701,22,774,888,179],function(){return e(e.s=3559)}),_N_E=e.O()}]);